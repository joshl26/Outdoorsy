<header class="site-header">
  <nav class="navbar navbar-expand-lg" aria-label="Main navigation">
    <div class="container-fluid">
      <!-- Brand / Logo -->
      <a class="navbar-brand" href="<%= basePath %>/" aria-label="Outdoorsy Home">
        <svg class="brand-icon" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M16 4L4 12L16 20L28 12L16 4Z" fill="currentColor" opacity="0.7"/>
          <path d="M4 20L16 28L28 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="brand-text">Outdoorsy</span>
        <span class="brand-tagline d-none d-xl-inline">Discover Nature</span>
      </a>

      <!-- Mobile Menu Toggle -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#mainNavigation"
        aria-controls="mainNavigation"
        aria-expanded="false"
        aria-label="Toggle navigation menu"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Navigation Content -->
      <div class="collapse navbar-collapse" id="mainNavigation">
        <!-- Primary Navigation -->
        <ul class="navbar-nav me-auto mb-2 mb-lg-0" role="menubar">
          <li class="nav-item" role="none">
            <a class="nav-link" href="<%= basePath %>/" role="menuitem">
              <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span class="nav-text">Home</span>
            </a>
          </li>
          <li class="nav-item" role="none">
            <a class="nav-link" href="<%= basePath %>/campgrounds" role="menuitem">
              <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
              <span class="nav-text">Explore</span>
            </a>
          </li>
          <% if (currentUser) { %>
          <li class="nav-item" role="none">
            <a class="nav-link" href="<%= basePath %>/campgrounds/new" role="menuitem">
              <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
              </svg>
              <span class="nav-text">Add Spot</span>
            </a>
          </li>
          <% } %>
          
          <!-- Discover Dropdown -->
          <li class="nav-item dropdown" role="none">
            <a class="nav-link dropdown-toggle" 
               href="#" 
               id="discoverMenu" 
               role="menuitem"
               data-bs-toggle="dropdown" 
               aria-expanded="false"
               aria-haspopup="true">
              <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
              </svg>
              <span class="nav-text">Discover</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="discoverMenu" role="menu">
              <li role="none">
                <a class="dropdown-item" href="<%= basePath %>/campgrounds?sort=rating" role="menuitem">
                  <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                  <span>Top Rated</span>
                </a>
              </li>
              <li role="none">
                <a class="dropdown-item" href="<%= basePath %>/campgrounds?sort=recent" role="menuitem">
                  <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span>Recently Added</span>
                </a>
              </li>
              <li role="none"><hr class="dropdown-divider"></li>
              <li role="none">
                <a class="dropdown-item" href="<%= basePath %>/api-docs" role="menuitem">
                  <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="16 18 22 12 16 6"></polyline>
                    <polyline points="8 6 2 12 8 18"></polyline>
                  </svg>
                  <span>API Docs</span>
                </a>
              </li>
            </ul>
          </li>
        </ul>

        <!-- Search Bar -->
        <form class="search-form d-flex me-lg-3" role="search" action="<%= basePath %>/campgrounds" method="GET">
          <div class="search-wrapper">
            <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <input 
              class="form-control search-input" 
              type="search" 
              placeholder="Search destinations..." 
              aria-label="Search campgrounds"
              name="search"
            />
          </div>
        </form>

        <!-- User Actions -->
        <ul class="navbar-nav user-actions" role="menubar">
          <% if (!currentUser) { %>
            <li class="nav-item" role="none">
              <a class="nav-link" href="<%= basePath %>/login" role="menuitem">
                <svg class="nav-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                  <polyline points="10 17 15 12 10 7"></polyline>
                  <line x1="15" y1="12" x2="3" y2="12"></line>
                </svg>
                <span class="nav-text">Sign In</span>
              </a>
            </li>
            <li class="nav-item" role="none">
              <a class="btn btn-primary btn-signup" href="<%= basePath %>/register" role="menuitem">
                <svg class="btn-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="8.5" cy="7" r="4"></circle>
                  <line x1="20" y1="8" x2="20" y2="14"></line>
                  <line x1="23" y1="11" x2="17" y2="11"></line>
                </svg>
                <span>Join Free</span>
              </a>
            </li>
          <% } else { %>
            <!-- User Profile Dropdown -->
            <li class="nav-item dropdown user-dropdown" role="none">
              <a class="nav-link dropdown-toggle user-menu-toggle" 
                 href="#" 
                 id="userMenu" 
                 role="menuitem"
                 data-bs-toggle="dropdown" 
                 aria-expanded="false"
                 aria-haspopup="true">
                <div class="user-avatar">
                  <% if (currentUser.avatar) { %>
                    <img src="<%= currentUser.avatar %>" alt="<%= currentUser.username %> profile picture" loading="lazy" />
                  <% } else { %>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                  <% } %>
                </div>
                <span class="user-name d-none d-lg-inline"><%= currentUser.username %></span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end dropdown-menu-modern user-menu" aria-labelledby="userMenu" role="menu">
                <li class="dropdown-header" role="none">
                  <div class="user-info">
                    <strong class="d-block"><%= currentUser.username %></strong>
                    <small class="text-muted"><%= currentUser.email || 'Outdoor Enthusiast' %></small>
                  </div>
                </li>
                <li role="none"><hr class="dropdown-divider"></li>
                <li role="none">
                  <a class="dropdown-item" href="<%= basePath %>/profile" role="menuitem">
                    <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>My Profile</span>
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item" href="<%= basePath %>/campgrounds?user=<%= currentUser._id %>" role="menuitem">
                    <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    </svg>
                    <span>My Campgrounds</span>
                  </a>
                </li>
                <li role="none">
                  <a class="dropdown-item" href="<%= basePath %>/favorites" role="menuitem">
                    <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span>Favorites</span>
                  </a>
                </li>
                <li role="none"><hr class="dropdown-divider"></li>
                <li role="none">
                  <a class="dropdown-item dropdown-item-logout" href="<%= basePath %>/logout" role="menuitem">
                    <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                      <polyline points="16 17 21 12 16 7"></polyline>
                      <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Sign Out</span>
                  </a>
                </li>
              </ul>
            </li>
          <% } %>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Progress Bar (optional - shows scroll progress) -->
  <div class="scroll-progress" role="progressbar" aria-label="Page scroll progress"></div>
</header>

<style>
  /* ===== CSS Variables ===== */
  :root {
    --nav-height: 72px;
    --nav-bg: rgba(255, 255, 255, 0.98);
    --nav-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    --nav-scrolled-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
    --primary: #2d5016;
    --primary-hover: #1f3910;
    --primary-light: rgba(45, 80, 22, 0.1);
    --text-primary: #2c3e50;
    --text-secondary: #6c757d;
    --border-radius: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* ===== Header & Navigation ===== */
  .site-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: var(--nav-bg);
    backdrop-filter: blur(20px) saturate(180%);
    box-shadow: var(--nav-shadow);
    transition: var(--transition);
  }

  .site-header.scrolled {
    box-shadow: var(--nav-scrolled-shadow);
  }

  .site-header.scrolled .navbar {
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }

  .navbar {
    padding: 1rem 0;
    transition: padding 0.3s ease;
  }

  /* ===== Brand / Logo ===== */
  .navbar-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary) !important;
    text-decoration: none;
    transition: transform 0.3s ease;
    padding: 0.5rem 0;
  }

  .navbar-brand:hover {
    transform: translateY(-2px);
  }

  .brand-icon {
    color: var(--primary);
    transition: transform 0.4s ease;
  }

  .navbar-brand:hover .brand-icon {
    transform: rotate(-10deg) scale(1.1);
  }

  .brand-text {
    font-size: 1.5rem;
    letter-spacing: -0.5px;
  }

  .brand-tagline {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-left: -0.5rem;
    padding-left: 0.75rem;
    border-left: 2px solid var(--primary-light);
  }

  /* ===== Navigation Links ===== */
  .navbar-nav {
    gap: 0.25rem;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem !important;
    border-radius: 10px;
    color: var(--text-primary) !important;
    font-weight: 500;
    font-size: 0.95rem;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--primary-light);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
    z-index: -1;
    border-radius: 10px;
  }

  .nav-link:hover::before,
  .nav-link.active::before {
    transform: scaleX(1);
  }

  .nav-link:hover {
    color: var(--primary) !important;
  }

  .nav-link.active {
    color: var(--primary) !important;
    font-weight: 600;
    background: var(--primary-light);
  }

  .nav-icon {
    flex-shrink: 0;
    opacity: 0.8;
    transition: all 0.3s ease;
  }

  .nav-link:hover .nav-icon {
    opacity: 1;
    transform: translateY(-2px);
  }

  /* ===== Dropdown Menus ===== */
  .dropdown-menu-modern {
    border: none;
    border-radius: var(--border-radius);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    padding: 0.75rem;
    margin-top: 0.75rem;
    min-width: 220px;
    animation: dropdownSlide 0.3s ease;
  }

  @keyframes dropdownSlide {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .dropdown-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    transition: var(--transition);
    color: var(--text-primary);
  }

  .dropdown-item:hover {
    background: var(--primary-light);
    color: var(--primary);
    transform: translateX(4px);
  }

  .dropdown-item:active {
    background: var(--primary-light);
  }

  .dropdown-icon {
    flex-shrink: 0;
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }

  .dropdown-item:hover .dropdown-icon {
    opacity: 1;
  }

  .dropdown-header {
    padding: 0.75rem 1rem;
    margin-bottom: 0.5rem;
  }

  .user-info strong {
    font-size: 0.95rem;
    color: var(--text-primary);
  }

  .dropdown-divider {
    margin: 0.5rem 0;
    opacity: 0.15;
  }

  .dropdown-item-logout {
    color: #dc3545;
  }

  .dropdown-item-logout:hover {
    background: rgba(220, 53, 69, 0.1);
    color: #dc3545;
  }

  /* ===== Search Bar ===== */
  .search-form {
    flex: 0 1 auto;
    margin: 0.75rem 0;
  }

  .search-wrapper {
    position: relative;
    min-width: 240px;
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
    z-index: 1;
  }

  .search-input {
    padding: 0.625rem 1rem 0.625rem 2.75rem;
    border: 2px solid transparent;
    border-radius: 50px;
    background: #f8f9fa;
    transition: var(--transition);
    font-size: 0.9rem;
  }

  .search-input:focus {
    background: white;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(45, 80, 22, 0.1);
    outline: none;
  }

  .search-input::placeholder {
    color: var(--text-secondary);
  }

  /* ===== User Actions ===== */
  .user-actions {
    gap: 0.5rem;
  }

  .btn-signup {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.5rem;
    border-radius: 50px;
    font-weight: 600;
    font-size: 0.9rem;
    background: linear-gradient(135deg, var(--primary), #3d6b1f);
    border: none;
    color: white;
    transition: var(--transition);
    box-shadow: 0 2px 8px rgba(45, 80, 22, 0.3);
  }

  .btn-signup:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(45, 80, 22, 0.4);
    background: linear-gradient(135deg, #3d6b1f, var(--primary));
  }

  .btn-icon {
    flex-shrink: 0;
  }

  /* ===== User Avatar & Menu ===== */
  .user-menu-toggle {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.375rem 0.75rem 0.375rem 0.375rem !important;
    background: var(--primary-light);
    border-radius: 50px;
  }

  .user-menu-toggle:hover {
    background: rgba(45, 80, 22, 0.15);
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--primary), #4ecdc4);
    color: white;
    overflow: hidden;
    flex-shrink: 0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .user-name {
    font-weight: 600;
    color: var(--text-primary);
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .user-menu {
    min-width: 260px;
  }

  /* ===== Mobile Toggler ===== */
  .navbar-toggler {
    padding: 0.5rem;
    border: 2px solid var(--primary-light);
    border-radius: 8px;
    transition: var(--transition);
  }

  .navbar-toggler:hover {
    background: var(--primary-light);
    border-color: var(--primary);
  }

  .navbar-toggler:focus {
    box-shadow: 0 0 0 0.25rem rgba(45, 80, 22, 0.15);
  }

  /* ===== Scroll Progress Bar ===== */
  .scroll-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), #4ecdc4, #ff6b35);
    width: 0%;
    transition: width 0.1s ease;
  }

  /* ===== Mobile Responsive ===== */
  @media (max-width: 991px) {
    .navbar {
      padding: 0.75rem 0;
    }

    .navbar-collapse {
      margin-top: 1rem;
      padding: 1rem;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .navbar-nav {
      gap: 0.5rem;
    }

    .nav-link {
      padding: 0.75rem 1rem !important;
    }

    .search-form {
      margin: 1rem 0;
      width: 100%;
    }

    .search-wrapper {
      width: 100%;
      min-width: unset;
    }

    .dropdown-menu-modern {
      box-shadow: none;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .user-actions {
      margin-top: 0.5rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .btn-signup {
      width: 100%;
      justify-content: center;
    }

    .brand-tagline {
      display: none !important;
    }
  }

  @media (max-width: 575px) {
    .brand-text {
      font-size: 1.25rem;
    }

    .nav-text {
      font-size: 0.95rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const header = document.querySelector('.site-header');
    const navbar = document.querySelector('.navbar');
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link:not(.dropdown-toggle)');
    const dropdownItems = document.querySelectorAll('.dropdown-item');
    const navCollapse = document.querySelector('.navbar-collapse');
    const progressBar = document.querySelector('.scroll-progress');
    
    // Highlight active nav link
    const currentPath = window.location.pathname;
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (currentPath === href || (href !== '/' && currentPath.startsWith(href))) {
        link.classList.add('active');
        link.setAttribute('aria-current', 'page');
      }
    });

    // Scroll effects
    let lastScroll = 0;
    
    window.addEventListener('scroll', function() {
      const currentScroll = window.scrollY;
      
      // Add scrolled class
      if (currentScroll > 20) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
      
      // Update progress bar
      const windowHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (currentScroll / windowHeight) * 100;
      progressBar.style.width = scrolled + '%';
      
      lastScroll = currentScroll;
    });

    // Close mobile menu when clicking a link
    [...navLinks, ...dropdownItems].forEach(link => {
      link.addEventListener('click', function() {
        if (window.innerWidth < 992 && navCollapse.classList.contains('show')) {
          const bsCollapse = bootstrap.Collapse.getInstance(navCollapse) || 
                            new bootstrap.Collapse(navCollapse);
          bsCollapse.hide();
        }
      });
    });

    // Smooth collapse animation
    navCollapse.addEventListener('show.bs.collapse', function() {
      this.style.transition = 'height 0.35s ease';
    });

    navCollapse.addEventListener('hide.bs.collapse', function() {
      this.style.transition = 'height 0.35s ease';
    });

    // Keyboard navigation for dropdowns
    document.querySelectorAll('.dropdown').forEach(dropdown => {
      dropdown.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const toggle = this.querySelector('[data-bs-toggle="dropdown"]');
          bootstrap.Dropdown.getInstance(toggle)?.hide();
          toggle.focus();
        }
      });
    });
  });
</script>